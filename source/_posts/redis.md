---
title: redis知识点总结
date: 2024-2-1 8:25:00
update: 2023-8-25 8:25:00
tags: redis
cover: https://images5.alphacoders.com/124/thumbbig-1240551.webp
---

## redis简介
&emsp;&emsp;redis是一种基于内存的数据库。

## redis如何避免缓存雪崩、击穿、穿透？
1、 缓存雪崩

&emsp;&emsp;通常为了保持缓存和数据库中数据的一致性。会给缓存中的key设置过期时间。当缓存数据过期后，用户访问的数据不在缓存中，就会去访问数据库，然后将数据更新到redis，使得后续能够直接命中缓存。

&emsp;&emsp;当大量缓存数据在同一时间失效，这时如果有大量的用户请求过来，都无法在redis中命中，这些请求只能都去访问数据库，极大加重数据库的压力，严重的话可能导致数据库崩溃，导致整个系统瘫痪，这样的问题称作缓存雪崩。

针对缓存崩溃问题，一般有两种解决方案：
- 随机化缓存时间。这样可以降低集体缓存数据过期的概率
- 设置缓存不过期。通过后台服务来更新缓存，这样缓存不会过期，也就不会导致缓存雪崩

2、缓存击穿

&emsp;&emsp;当热点数据过期，然后大量的用户请求该热点数据，此时无法在缓存中命中，就会转去访问数据库，数据库很容易被高并发的请求冲垮，这就是缓存击穿的问题。

解决方案：
- 互斥锁，保证同一时刻只有一个业务线程请求缓存，如果本次未能获取锁，要么等待锁释放再访问缓存，要么直接返回空值或者默认值。
- 不给热点数据设置过期时间，由后台异步更新缓存，或者在热点数据要过期之前通知后台线程更新缓存以及重新设立过期时间。

3、 缓存穿透

&emsp;&emsp;当发生上述两种情况，数据库中仍然持有要访问的数据，一旦缓存中重新恢复数据，数据库的压力就会减轻。

假设一种情况，当访问的数据既不在缓存中，也不在数据库中，这时如果有大量类似的请求过来，数据库的压力就会骤增，这就是缓存穿透的问题。

针对缓存穿透问题，一般有三种解决方案：
- 限制非法访问请求。在API入口处对请求参数进行检查，如果判断是恶意请求就直接返回错误，避免访问缓存和数据库
- 设置空值或者默认值。当发现缓存穿透的问题时，可以针对查询的数据，在缓存中设置空值或者默认值，这样后续请求就可以读到空值或者默认值返回给应用，而不会继续查询数据库
- 使用布隆过滤器。可以在写入数据库时布隆过滤器用来判断数据是否存在（假阳性）。这样即使发生了缓存穿透，也只是对缓存和布隆过滤器的大量访问，而不会涉及到大量查询数据库的操作，进而避免了缓存穿透。同时，redis本身也是支持布隆过滤器的。

## redis中的缓存更新策略
redis中使用Cache Aside策略。应用程序直接与缓存和数据库进行交互，负责维护缓存，该策略可以细分为读策略和写策略。

写策略：
- 先更新数据库中的数据
- 再删除缓存中的数据

读策略：
- 读取的数据直接命中缓存，直接返回
- 未命中，从数据库中读数据，然后写回缓存，并返回给用户

Cache Aside适合读多写少的场景